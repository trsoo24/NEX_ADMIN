import{U as J,W,$ as M,e as T,a0 as X,c as y,d as u,w as c,a as e,H as i,F as O,g as j,o as w,R as k,D as E,X as F,Y,J as B,t as _,n as q}from"./index-Cl5wPPhe.js";import{a as H}from"./axios-B4uVmeYG.js";import{V as G,a as b}from"./VInput-BUIgaqBY.js";import{V as K}from"./VTextField-BhZXTpsm.js";import{V as Q}from"./VSelect-Bv22Wbij.js";import"./VGrid-CcRiOlXM.js";import"./transition-D5l4heR3.js";import"./VField-BlXeQDtL.js";import"./forwardRefs-DWGaNmQL.js";import"./index-C45fu6iG.js";import"./VMenu-DTZe6M0h.js";import"./createSimpleFunctional-CDvYsknp.js";import"./VAvatar-ARNVk7LF.js";import"./VImg-Ba0C5lQM.js";import"./VDivider-DJLQHtmm.js";import"./VOverlay-Cz0KYxXo.js";import"./VCheckboxBtn-CE1nV8AX.js";const Z=J("main",{state:()=>({fileType:"",contents:[],total:"",pageSize:10,currentPage:1}),actions:{async getContents(x,d,h,v,g=1){const p="http://192.168.10.31:8080/reconciliation/adcb";try{const a=await H.get(p,{params:{dcb:x,startDate:d,endDate:h,selectedFileType:v,page:g,pageSize:this.pageSize}});this.contents=a.data.responsePage.content,this.total=a.data.responsePage.totalElements,this.currentPage=a.data.responsePage.number+1,this.fileType=v}catch{alert("작업 중 에러가 발생했습니다.")}},async exportData(x,d,h,v){const g="http://192.168.10.31:8080/reconciliation/adcb/excel";try{const p=await H.get(g,{params:{dcb:x,startDate:d,endDate:h,selectedFileType:v},responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}),a=new Date,f=a.getFullYear(),S=String(a.getMonth()+1).padStart(2,"0"),P=String(a.getDate()).padStart(2,"0"),R=String(a.getHours()).padStart(2,"0"),D=String(a.getMinutes()).padStart(2,"0"),U=String(a.getSeconds()).padStart(2,"0"),A=`${f}${S}${P}${R}${D}${U}`,C=p.headers["content-disposition"],I=C?C.split("filename=")[1]:`${x} ${d}~${h} 대사 파일_${A}.xlsx`,$=new Blob([p.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),V=window.URL.createObjectURL($),n=document.createElement("a");n.href=V,n.setAttribute("download",I),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(V)}catch{alert("작업 중 에러가 발생했습니다.")}}}}),N={class:"content-wrapper"},ee=e("br",null,null,-1),te=["max"],ae=["min","max"],ne=e("br",null,null,-1),le={class:"table-container"},oe=e("thead",null,[e("tr",null,[e("th",null,"번호"),e("th",null,"등록일자"),e("th",null,"이벤트일자"),e("th",null,"파일 구분"),e("th",null,"처리 서버"),e("th",null,"파일명")])],-1),se={key:0},ie=e("td",{colspan:"6",style:{"text-align":"center"}},"데이터가 없습니다.",-1),re=[ie],ue={class:"pagination"},ce=e("br",null,null,-1),de=e("br",null,null,-1),pe=["disabled"],me=e("b",null,"이전",-1),ve=[me],fe=["onClick"],_e=["disabled"],he=e("b",null,"다음",-1),ge=[he],ze={__name:"Reconciliation-ADCB",setup(x){const d=Z(),{fileType:h,contents:v,total:g,pageSize:p,currentPage:a}=W(d),f=M(()=>g.value?Math.ceil(g.value/p.value):0),S=l=>{if(n.value===""||n.value===null)return alert("DCB를 선택해주세요."),!1;l>=1&&l<=f.value&&d.getContents(n.value,s.value,r.value,m.value,l)},P=()=>{a.value>1&&S(a.value-1)},R=()=>{a.value<f.value&&S(a.value+1)},D=()=>{const l=new Date,o=new Date(l);return o.setDate(l.getDate()-1),o.toISOString().split("T")[0]},U=(l,o=31)=>{const t=new Date(l);return t.setDate(t.getDate()-o),t.toISOString().split("T")[0]},A=()=>{if(n.value===""||n.value==null){alert("조회할 DCB를 선택해주세요.");return}if(s.value===""||r.value===""){alert("조회할 날짜를 모두 선택해주세요.");return}const l=new Date(D()),o=new Date(s.value);if((new Date(r.value).getTime()-o.getTime())/(1e3*3600*24)>30){alert("일별 조회는 최대 31일까지만 가능합니다.");return}if(new Date(s.value)>l||new Date(r.value)>l){alert("선택한 날의 데이터가 아직 생성되지 않았습니다.");return}C()},C=()=>{d.getContents(n.value,s.value,r.value,m.value,a.value)},I=()=>{if(n.value===""||n.value==null){alert("조회할 DCB를 선택해주세요.");return}if(s.value===""||r.value===""){alert("조회할 날짜를 모두 선택해주세요.");return}const l=new Date(D());if(new Date(s.value)>l||new Date(r.value)>l){alert("선택한 날의 데이터가 아직 생성되지 않았습니다.");return}$()},$=async()=>{await d.exportData(n.value,s.value,r.value,m.value)},V=M(()=>["전체","transaction","settlement","exception"]);let n=T("ADCB"),m=h,z=T(D()),s=T(U(new Date)),r=T(D());return X(()=>{C(n.value,s.value,r.value,m.value,a.value)}),(l,o)=>(w(),y("div",N,[ee,u(G,{align:"center",justify:"end"},{default:c(()=>[u(b,{cols:"auto"},{default:c(()=>[u(K,{class:"min-width-select",label:"DCB",modelValue:i(n),"onUpdate:modelValue":o[0]||(o[0]=t=>k(n)?n.value=t:n=t),variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1}),u(b,{cols:"auto"},{default:c(()=>[E(e("input",{type:"date","onUpdate:modelValue":o[1]||(o[1]=t=>k(s)?s.value=t:s=t),max:i(z)},null,8,te),[[F,i(s)]]),E(e("input",{type:"date","onUpdate:modelValue":o[2]||(o[2]=t=>k(r)?r.value=t:r=t),min:i(s),max:i(z)},null,8,ae),[[F,i(r)]])]),_:1}),u(b,{cols:"auto"},{default:c(()=>[u(Q,{class:"min-width-select2",clearable:"",label:"파일 구분",placeholder:"파일 구분",items:V.value,modelValue:i(m),"onUpdate:modelValue":o[3]||(o[3]=t=>k(m)?m.value=t:m=t),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),u(b,{cols:"auto"},{default:c(()=>[u(Y,{variant:"elevated",onClick:A},{default:c(()=>[B(" 조회 ")]),_:1})]),_:1}),u(b,{cols:"auto"},{default:c(()=>[u(Y,{variant:"elevated",onClick:I},{default:c(()=>[B(" 엑셀 ")]),_:1})]),_:1})]),_:1}),ne,e("div",le,[e("div",null,[e("table",null,[oe,e("tbody",null,[i(v).length===0?(w(),y("tr",se,re)):(w(!0),y(O,{key:1},j(i(v),(t,L)=>(w(),y("tr",{key:t.id},[e("td",null,_((i(a)-1)*i(p)+L+1),1),e("td",null,_(t.ctn),1),e("td",null,_(t.email),1),e("td",null,_(t.name),1),e("td",null,_(t.registrar),1),e("td",null,_(t.registrationDate),1)]))),128))])]),e("div",ue,[ce,de,u(G,{align:"center",justify:"center"},{default:c(()=>[u(b,{cols:"auto"},{default:c(()=>[e("button",{onClick:P,disabled:i(a)===1},ve,8,pe),B("   "),(w(!0),y(O,null,j(f.value,t=>(w(),y("button",{key:t,onClick:L=>S(t),class:q({active:t===i(a)})},_(t),11,fe))),128)),B("   "),e("button",{onClick:R,disabled:i(a)===f.value||f.value<1},ge,8,_e)]),_:1})]),_:1})])])])]))}};export{ze as default};
