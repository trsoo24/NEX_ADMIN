import{U as G,W as H,$ as K,e as V,a0 as O,c as y,d as c,w as h,a as t,o as S,H as r,R as U,D as L,X as A,Y as E,J as d,F as j,g as F,t as n,n as J}from"./index-B8EbGMN3.js";import{a as z}from"./axios-B4uVmeYG.js";import{V as Y,a as w}from"./VInput-msPG-MP_.js";import{V as W}from"./VTable-QS9nLRnj.js";import{V as X}from"./VTextField-Ujn_yGZZ.js";import"./VGrid-D8xKyB2U.js";import"./transition-h0L7ZsHG.js";import"./VField-8s2H7kOf.js";import"./forwardRefs-DWGaNmQL.js";import"./index-Qv1F-OC0.js";const q=G("main",{state:()=>({contents:[],total:"",pageSize:10,currentPage:1}),actions:{async getContents(C,p,_,g=1){const m="http://localhost:8080/reconciliation/sdcb";try{const l=await z.get(m,{params:{dcb:C,startDate:p,endDate:_,page:g,pageSize:this.pageSize}});this.contents=l.data.responsePage.content,this.total=l.data.responsePage.totalElements,this.currentPage=l.data.responsePage.number+1}catch{alert("작업 중 에러가 발생했습니다.")}},async exportData(C,p,_){const g="http://localhost:8080/reconciliation/sdcb/excel";try{const m=await z.get(g,{params:{dcb:C,startDate:p,endDate:_},responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}),l=new Date,f=l.getFullYear(),x=String(l.getMonth()+1).padStart(2,"0"),M=String(l.getDate()).padStart(2,"0"),P=String(l.getHours()).padStart(2,"0"),b=String(l.getMinutes()).padStart(2,"0"),$=String(l.getSeconds()).padStart(2,"0"),R=`${f}${x}${M}${P}${b}${$}`,D=m.headers["content-disposition"],T=D?D.split("filename=")[1]:`${C} ${p}~${_} 대사 파일_${R}.xlsx`,B=new Blob([m.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),a=window.URL.createObjectURL(B),v=document.createElement("a");v.href=a,v.setAttribute("download",T),document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(a)}catch{alert("작업 중 에러가 발생했습니다.")}}}}),Q={class:"content-wrapper"},Z=t("br",null,null,-1),N=["max"],tt=["min","max"],et=t("br",null,null,-1),lt=t("thead",null,[t("tr",null,[t("th",null,"번호"),t("th",null,"Transaction ID"),t("th",null,"이벤트 일자"),t("th",null,"처리 파일"),t("th",null,"시작 시간"),t("th",null,"종료 시간"),t("th",null,"처리 서버"),t("th",null,"처리 결과"),t("th",null,"총 결과 수"),t("th",null,"성공 결과 수"),t("th",null,[d("SKP에만 "),t("br"),d(" 존재")]),t("th",null,[d("SKP에만 "),t("br"),d(" 존재하는 "),t("br"),d(" 결과 수")]),t("th",null,[d("LGU에만 "),t("br"),d(" 존재하는 "),t("br"),d(" 결과 수")]),t("th",null,"실패 결과 수"),t("th",null,"시작 일자"),t("th",null,"사유")])],-1),at={key:0},nt=t("td",{colspan:"16",style:{"text-align":"center"}},"데이터가 없습니다.",-1),ot=[nt],st={class:"pagination"},ut=t("br",null,null,-1),rt=t("br",null,null,-1),it=["disabled"],dt=t("b",null,"이전",-1),ct=[dt],ht=["onClick"],pt=["disabled"],mt=t("b",null,"다음",-1),vt=[mt],kt={__name:"Reconciliation-SDCB",setup(C){const p=q(),{contents:_,total:g,pageSize:m,currentPage:l}=H(p),f=K(()=>g.value?Math.ceil(g.value/m.value):0),x=o=>{if(a.value===""||a.value===null)return alert("DCB를 선택해주세요."),!1;o>=1&&o<=f.value&&p.getContents(a.value,s.value,i.value,o)},M=()=>{l.value>1&&x(l.value-1)},P=()=>{l.value<f.value&&x(l.value+1)},b=()=>{const o=new Date,u=o.getFullYear(),e=String(o.getMonth()).padStart(2,"0");return`${u}-${e}`},$=o=>{const u=new Date(o),e=u.getMonth();u.setMonth(e-3);const k=u.getFullYear(),I=String(u.getMonth()+1).padStart(2,"0");return`${k}-${I}`},R=()=>{if(a.value===""||a.value==null){alert("조회할 DCB를 선택해주세요.");return}if(s.value===""||i.value===""){alert("조회할 날짜를 모두 선택해주세요.");return}const o=b();if(s.value>o||i.value>o){alert("선택한 달의 데이터가 아직 생성되지 않았습니다.");return}D()},D=()=>{p.getContents(a.value,s.value,i.value,l.value)},T=()=>{if(a.value===""||a.value==null){alert("조회할 DCB를 선택해주세요.");return}if(s.value===""||i.value===""){alert("조회할 날짜를 모두 선택해주세요.");return}const o=b();if(s.value>o||i.value>o){alert("선택한 달의 데이터가 아직 생성되지 않았습니다.");return}B()},B=async()=>{await p.exportData(a.value,s.value,i.value)};let a=V("SDCB"),v=V(b()),s=V($(new Date)),i=V(b());return O(()=>{D(a.value,s.value,i.value)}),(o,u)=>(S(),y("div",Q,[Z,c(Y,{align:"center",justify:"end"},{default:h(()=>[c(w,{cols:"auto"},{default:h(()=>[c(X,{class:"min-width-select",label:"DCB",modelValue:r(a),"onUpdate:modelValue":u[0]||(u[0]=e=>U(a)?a.value=e:a=e),variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1}),c(w,{cols:"auto"},{default:h(()=>[L(t("input",{type:"month","onUpdate:modelValue":u[1]||(u[1]=e=>U(s)?s.value=e:s=e),max:r(v)},null,8,N),[[A,r(s)]]),L(t("input",{type:"month","onUpdate:modelValue":u[2]||(u[2]=e=>U(i)?i.value=e:i=e),min:r(s),max:r(v)},null,8,tt),[[A,r(i)]])]),_:1}),c(w,{cols:"auto"},{default:h(()=>[c(E,{variant:"elevated",onClick:R},{default:h(()=>[d(" 조회 ")]),_:1})]),_:1}),c(w,{cols:"auto"},{default:h(()=>[c(E,{variant:"elevated",onClick:T},{default:h(()=>[d(" 엑셀 ")]),_:1})]),_:1})]),_:1}),et,c(W,{class:"table-container"},{default:h(()=>[t("div",null,[t("table",null,[lt,t("tbody",null,[r(_).length===0?(S(),y("tr",at,ot)):(S(!0),y(j,{key:1},F(r(_),(e,k)=>(S(),y("tr",{key:e.filename},[t("td",null,n((r(l)-1)*r(m)+k+1),1),t("td",null,n(e.transactionId),1),t("td",null,n(e.month),1),t("td",null,n(e.filename),1),t("td",null,n(e.startTime),1),t("td",null,n(e.endTime),1),t("td",null,n(e.server),1),t("td",null,n(e.result),1),t("td",null,n(e.resultCount),1),t("td",null,n(e.successCount),1),t("td",null,n(e.onlySkpExist),1),t("td",null,n(e.onlySkpExistCount),1),t("td",null,n(e.onlyLguExistCount),1),t("td",null,n(e.failureCount),1),t("td",null,n(e.date),1),t("td",null,n(e.reason),1)]))),128))])]),t("div",st,[ut,rt,c(Y,{align:"center",justify:"center"},{default:h(()=>[c(w,{cols:"auto"},{default:h(()=>[t("button",{onClick:M,disabled:r(l)===1},ct,8,it),d("   "),(S(!0),y(j,null,F(f.value,e=>(S(),y("button",{key:e,onClick:k=>x(e),class:J({active:e===r(l)})},n(e),11,ht))),128)),d("   "),t("button",{onClick:P,disabled:r(l)===f.value||f.value<1},vt,8,pt)]),_:1})]),_:1})])])]),_:1})]))}};export{kt as default};
