import{U as P,W as E,e as A,c as y,d as f,w as D,a as o,o as g,H as l,R as U,D as C,Z as H,X as B,h as V,Y as j,J as I,F,g as N,t as b}from"./index-BNrJ-Dvj.js";import{a as Y}from"./axios-B4uVmeYG.js";import{d as G}from"./dcb-DFDBfy1j.js";import{V as O,a as k}from"./VField-Cziex-qH.js";import{V as J}from"./VTable-BLQw7MbS.js";import{V as W}from"./VSelect-KAzCz1Mg.js";import"./VGrid-DeylvMMY.js";import"./index-BPvLzGhW.js";import"./VTextField-Cyw_K3aJ.js";import"./VMenu-d9ONUfxi.js";import"./createSimpleFunctional-C8sGjN9l.js";import"./VAvatar-TsXOFCQi.js";import"./VImg-Djp65FB0.js";import"./VDivider-BD2uBEGn.js";import"./VOverlay-DUP5QlJ3.js";import"./VCheckboxBtn-B0yZRWh3.js";const X=P("main",{state:()=>({dcb:"",contents:[]}),actions:{async getDailyStatistics(h,c,v){const _="http://localhost:9999/payment/range/day";try{const r=await Y.get(_,{params:{dcb:h,startDate:c,endDate:v}});this.contents=r.data.mapResult,this.dcb=h}catch{alert("작업 중 에러가 발생했습니다.")}},async getMonthlyStatistics(h,c,v){const _="http://localhost:9999/payment/range/month";try{const r=await Y.get(_,{params:{dcb:h,startDate:c,endDate:v}});this.contents=r.data.mapResult,this.dcb=h}catch{alert("작업 중 에러가 발생했습니다.")}},async exportDailyData(h,c,v){const _="http://localhost:9999/payment/range/day/excel";try{const r=await Y.get(_,{params:{dcb:h,startDate:c,endDate:v},responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}),p=new Date,w=p.getFullYear(),M=String(p.getMonth()+1).padStart(2,"0"),$=String(p.getDate()).padStart(2,"0"),u=String(p.getHours()).padStart(2,"0"),i=String(p.getMinutes()).padStart(2,"0"),S=String(p.getSeconds()).padStart(2,"0"),a=`${w}${M}${$}${u}${i}${S}`,n=r.headers["content-disposition"],T=n?n.split("filename=")[1]:`${h} ${c}~${v} 기간별 일 결제 통계_${a}.xlsx`,L=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),x=window.URL.createObjectURL(L),m=document.createElement("a");m.href=x,m.setAttribute("download",T),document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(x)}catch{alert("작업 중 에러가 발생했습니다.")}},async exportMonthlyData(h,c,v){const _="http://localhost:9999/payment/range/month/excel";try{const r=await Y.get(_,{params:{dcb:h,startDate:c,endDate:v},responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}),p=new Date,w=p.getFullYear(),M=String(p.getMonth()+1).padStart(2,"0"),$=String(p.getDate()).padStart(2,"0"),u=String(p.getHours()).padStart(2,"0"),i=String(p.getMinutes()).padStart(2,"0"),S=String(p.getSeconds()).padStart(2,"0"),a=`${w}${M}${$}${u}${i}${S}`,n=r.headers["content-disposition"],T=n?n.split("filename=")[1]:`${h} ${c}~${v} 기간별 월 결제 통계_${a}.xlsx`,L=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),x=window.URL.createObjectURL(L),m=document.createElement("a");m.href=x,m.setAttribute("download",T),document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(x)}catch{alert("작업 중 에러가 발생했습니다.")}}}}),Z={class:"content-wrapper"},q=o("div",{class:"label-text"},[I(" ※ 일별 최대 조회 기간 : "),o("b",null,"31일"),I(),o("br"),I(" ※ 월별 최대 조회 기간 : "),o("b",null,"3달")],-1),z=o("option",{value:"day"},"일별",-1),K=o("option",{value:"month"},"월별",-1),Q=[z,K],tt=["max"],et=["min","max"],at=["max"],nt=["min","max"],ot=o("br",null,null,-1),st={class:"table-wrapper"},lt=o("thead",null,[o("tr",null,[o("th",null,"기간"),o("th",null,"결제 구간"),o("th",null,"결제자 수"),o("th",null,"전체 결제 건수"),o("th",null,"결제 금액"),o("th",null,"환불/취소 금액"),o("th",null,"실결제 금액"),o("th",null,"인당 결제 금액")])],-1),rt={key:0},it=o("td",{colspan:"8",style:{"text-align":"center"}},"데이터가 없습니다.",-1),dt=[it],ut=["rowspan"],ct=["rowspan"],kt={__name:"RangePaymentStatistics",setup(h){const c=X(),{dcb:v,contents:_}=E(c),r=()=>{const s=new Date,e=new Date(s);return e.setDate(s.getDate()-1),e.toISOString().split("T")[0]},p=(s,e=31)=>{const t=new Date(s);return t.setDate(t.getDate()-e),t.toISOString().split("T")[0]},w=()=>{const s=new Date,e=s.getFullYear(),t=String(s.getMonth()).padStart(2,"0");return`${e}-${t}`},M=s=>{const e=new Date(s),t=e.getMonth();e.setMonth(t-3);const d=e.getFullYear(),R=String(e.getMonth()+1).padStart(2,"0");return`${d}-${R}`},$=()=>{a.value="",n.value="",i.value==="day"?(S.value=r(),a.value=p(new Date),n.value=r()):(S.value=w(),a.value=M(new Date),n.value=w())};let u=v,i=A("month"),S=A(w()),a=A(M(new Date)),n=A(w());const T=()=>{if(u.value===""||u.value==null){alert("조회할 DCB를 선택해주세요.");return}if(a.value===""||n.value===""){alert("조회할 날짜를 모두 선택해주세요.");return}if(i.value==="day"){const s=new Date(r()),e=new Date(a.value),t=new Date(n.value);if((t.getTime()-e.getTime())/(1e3*3600*24)>30){alert("일별 조회는 최대 31일까지만 가능합니다.");return}if(e>s||t>s){alert("선택한 날의 데이터가 아직 생성되지 않았습니다.");return}}else{const s=w(),e=new Date(a.value),t=new Date(n.value),d=e.getMonth()+1+e.getFullYear()*12;if(t.getMonth()+1+t.getFullYear()*12-d>2){alert("월별 조회는 최대 3개월까지만 가능합니다.");return}if(a.value>s||n.value>s){alert("선택한 달의 데이터가 아직 생성되지 않았습니다.");return}}_.value=[],L()},L=async()=>{i.value==="day"?await c.getDailyStatistics(u.value,a.value,n.value):await c.getMonthlyStatistics(u.value,a.value,n.value)},x=()=>{if(u.value===""||u.value==null){alert("조회할 DCB를 선택해주세요.");return}if(a.value===""||n.value===""){alert("조회할 날짜를 모두 선택해주세요.");return}if(i.value==="day"){const s=new Date(r());if(new Date(a.value)>s||new Date(n.value)>s){alert("선택한 날의 데이터가 아직 생성되지 않았습니다.");return}}else{const s=w();if(a.value>s||n.value>s){alert("선택한 달의 데이터가 아직 생성되지 않았습니다.");return}}m()},m=()=>{i.value==="day"?c.exportDailyData(u.value,a.value,n.value):c.exportMonthlyData(u.value,a.value,n.value)};return(s,e)=>(g(),y("div",Z,[f(O,null,{default:D(()=>[f(k,{cols:"auto"},{default:D(()=>[q]),_:1})]),_:1}),f(O,{align:"center",justify:"end"},{default:D(()=>[f(k,{cols:"auto"},{default:D(()=>[f(W,{class:"min-width-select",clearable:"",label:"DCB",placeholder:"DCB",items:l(G),modelValue:l(u),"onUpdate:modelValue":e[0]||(e[0]=t=>U(u)?u.value=t:u=t),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),f(k,{cols:"auto"},{default:D(()=>[C(o("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>U(i)?i.value=t:i=t),onChange:$},Q,544),[[H,l(i)]])]),_:1}),f(k,{cols:"auto"},{default:D(()=>[l(i)==="day"?C((g(),y("input",{key:0,type:"date","onUpdate:modelValue":e[2]||(e[2]=t=>U(a)?a.value=t:a=t),max:l(S)},null,8,tt)),[[B,l(a)]]):V("",!0),l(i)==="day"?C((g(),y("input",{key:1,type:"date","onUpdate:modelValue":e[3]||(e[3]=t=>U(n)?n.value=t:n=t),min:l(a),max:l(S)},null,8,et)),[[B,l(n)]]):V("",!0),l(i)==="month"?C((g(),y("input",{key:2,type:"month","onUpdate:modelValue":e[4]||(e[4]=t=>U(a)?a.value=t:a=t),max:l(S)},null,8,at)),[[B,l(a)]]):V("",!0),l(i)==="month"?C((g(),y("input",{key:3,type:"month","onUpdate:modelValue":e[5]||(e[5]=t=>U(n)?n.value=t:n=t),min:l(a),max:l(S)},null,8,nt)),[[B,l(n)]]):V("",!0)]),_:1}),f(k,{cols:"auto"},{default:D(()=>[f(j,{variant:"elevated",onClick:T},{default:D(()=>[I(" 조회 ")]),_:1})]),_:1}),f(k,{cols:"auto"},{default:D(()=>[f(j,{variant:"elevated",onClick:x},{default:D(()=>[I(" 엑셀 ")]),_:1})]),_:1})]),_:1}),ot,o("div",st,[f(J,{class:"table-container"},{default:D(()=>[lt,o("tbody",null,[l(_).length===0?(g(),y("tr",rt,dt)):(g(!0),y(F,{key:1},N(l(_),t=>(g(),y(F,null,[(g(!0),y(F,null,N(t,(d,R)=>(g(),y("tr",{key:d.costRange},[d.stat_month&&R===0?(g(),y("td",{key:0,rowspan:t.length,class:"start-table"},b(d.stat_month),9,ut)):V("",!0),d.stat_day&&R===0?(g(),y("td",{key:1,rowspan:t.length,class:"start-table"},b(d.stat_day),9,ct)):V("",!0),o("td",null,b(d.a_stat),1),o("td",null,b(d.b_stat),1),o("td",null,b(d.c_stat),1),o("td",null,b(d.d_stat),1),o("td",null,b(d.e_stat),1),o("td",null,b(d.f_stat),1),o("td",null,b(d.g_stat),1)]))),128))],64))),256))])]),_:1})])]))}};export{kt as default};
