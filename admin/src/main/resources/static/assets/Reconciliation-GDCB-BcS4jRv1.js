import{U as G,W as Y,$ as M,e as B,a0 as H,c as D,d as n,w as u,a as t,H as p,F as j,g as I,o as x,R as $,D as J,X as N,Y as O,J as T,t as g,n as W}from"./index-B8EbGMN3.js";import{a as A}from"./axios-B4uVmeYG.js";import{V as z,a as S}from"./VInput-msPG-MP_.js";import{V as X}from"./VTextField-Ujn_yGZZ.js";import{V as q}from"./VSelect-CZOfT56l.js";import"./VGrid-D8xKyB2U.js";import"./transition-h0L7ZsHG.js";import"./VField-8s2H7kOf.js";import"./forwardRefs-DWGaNmQL.js";import"./index-Qv1F-OC0.js";import"./VMenu-BRgnxf6I.js";import"./createSimpleFunctional-DwNSd_ti.js";import"./VAvatar-IsnjnCc2.js";import"./VImg-BNBQc3z5.js";import"./VDivider-DJKyB90Z.js";import"./VOverlay-ColyBhV7.js";import"./VCheckboxBtn-BDq1Ohb6.js";const K=G("main",{state:()=>({fileType:"",contents:[],total:"",pageSize:10,currentPage:1}),actions:{async getContents(y,s,f,m=1){const r="http://localhost:8080/reconciliation/gdcb";try{const o=await A.get(r,{params:{dcb:y,month:s,fileType:f,page:m,pageSize:this.pageSize}});this.contents=o.data.responsePage.content,this.total=o.data.responsePage.totalElements,this.currentPage=o.data.responsePage.number+1,this.fileType=f}catch{alert("작업 중 에러가 발생했습니다.")}},async exportData(y,s,f){const m="http://localhost:8080/reconciliation/gdcb/excel";try{const r=await A.get(m,{params:{dcb:y,month:s,fileType:f},responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}),o=new Date,a=o.getFullYear(),c=String(o.getMonth()+1).padStart(2,"0"),b=String(o.getDate()).padStart(2,"0"),C=String(o.getHours()).padStart(2,"0"),h=String(o.getMinutes()).padStart(2,"0"),R=String(o.getSeconds()).padStart(2,"0"),U=`${a}${c}${b}${C}${h}${R}`,k=r.headers["content-disposition"],L=k?k.split("filename=")[1]:`${y} ${c} 대사 파일_${U}.xlsx`,P=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),V=window.URL.createObjectURL(P),w=document.createElement("a");w.href=V,w.setAttribute("download",L),document.body.appendChild(w),w.click(),document.body.removeChild(w),window.URL.revokeObjectURL(V)}catch{alert("작업 중 에러가 발생했습니다.")}},async downloadFile(y,s,f,m){const r="http://localhost:8080/reconciliation/gdcb/download";try{const o=await A.get(r,{params:{dcb:y,month:s,fileType:f,fileName:m},responseType:"blob",headers:{Accept:"application/octet-stream"}});console.dir(o);const a=o.headers["content-disposition"],c=a?a.split("filename=")[1]:m,b=new Blob([o.data],{type:"application/octet-stream"}),C=window.URL.createObjectURL(b),h=document.createElement("a");h.href=C,h.setAttribute("download",c),document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(C)}catch{alert("작업 중 에러가 발생했습니다.")}}}}),Q={class:"content-wrapper"},Z=t("br",null,null,-1),tt=["max"],et=t("br",null,null,-1),ot={class:"table-container"},at=t("thead",null,[t("tr",null,[t("th",null,"번호"),t("th",null,"구매년월"),t("th",null,"파일 구분"),t("th",null,"ID"),t("th",null,"파일명"),t("th",null,"작업 결과"),t("th",null,"일자")])],-1),lt={key:0},nt=t("td",{colspan:"7",style:{"text-align":"center"}},"데이터가 없습니다.",-1),st=[nt],it=["onClick"],rt={class:"pagination"},ct=t("br",null,null,-1),dt=t("br",null,null,-1),ut=["disabled"],pt=t("b",null,"이전",-1),mt=[pt],ht=["onClick"],vt=["disabled"],_t=t("b",null,"다음",-1),ft=[_t],Ft={__name:"Reconciliation-GDCB",setup(y){const s=K(),{fileType:f,contents:m,total:r,pageSize:o,currentPage:a}=Y(s),c=M(()=>r.value?Math.ceil(r.value/o.value):0),b=_=>{if(l.value===""||l.value===null)return alert("DCB를 선택해주세요."),!1;_>=1&&_<=c.value&&s.getContents(l.value,v.value,i.value,_)},C=()=>{a.value>1&&b(a.value-1)},h=()=>{a.value<c.value&&b(a.value+1)},R=()=>{const _=new Date,d=_.getFullYear(),e=String(_.getMonth()).padStart(2,"0");return`${d}-${e}`},U=()=>{if(l.value===""||l.value==null){alert("조회할 DCB를 선택해주세요.");return}if(i.value===""){alert("조회할 파일 유형을 선택해주세요.");return}i.value==="전체"&&(i.value=""),k()},k=()=>{s.getContents(l.value,v.value,i.value,a.value)},L=()=>{if(l.value===""||l.value==null){alert("조회할 DCB를 선택해주세요.");return}P()},P=async()=>{await s.exportData(l.value,v.value,i.value)},V=async(_,d)=>{await s.downloadFile(l.value,v.value,_,d)},w=M(()=>["전체","Outstanding","invoice Details","invoice Summary","Invoice Details_기존 결제","Invoice Details_소액 결제","구글 기준 월 대사 (전체)","구글 기준 월 대사 (불일치)"]);let l=B("GDCB"),i=f,v=B(R());const E=B(R());return H(()=>{k(l.value,v.value,i.value,a.value)}),(_,d)=>(x(),D("div",Q,[Z,n(z,{align:"center",justify:"end"},{default:u(()=>[n(S,{cols:"auto"},{default:u(()=>[n(X,{class:"min-width-select",label:"DCB",modelValue:p(l),"onUpdate:modelValue":d[0]||(d[0]=e=>$(l)?l.value=e:l=e),variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1}),n(S,{cols:"auto"},{default:u(()=>[J(t("input",{type:"month","onUpdate:modelValue":d[1]||(d[1]=e=>$(v)?v.value=e:v=e),max:E.value},null,8,tt),[[N,p(v)]])]),_:1}),n(S,{cols:"auto"},{default:u(()=>[n(q,{class:"min-width-select2",clearable:"",label:"파일 구분",placeholder:"파일 구분",items:w.value,modelValue:p(i),"onUpdate:modelValue":d[2]||(d[2]=e=>$(i)?i.value=e:i=e),variant:"outlined"},null,8,["items","modelValue"])]),_:1}),n(S,{cols:"auto"},{default:u(()=>[n(O,{variant:"elevated",onClick:U},{default:u(()=>[T(" 조회 ")]),_:1})]),_:1}),n(S,{cols:"auto"},{default:u(()=>[n(O,{variant:"elevated",onClick:L},{default:u(()=>[T(" 엑셀 ")]),_:1})]),_:1})]),_:1}),et,t("div",ot,[t("div",null,[t("table",null,[at,t("tbody",null,[p(m).length===0?(x(),D("tr",lt,st)):(x(!0),D(j,{key:1},I(p(m),(e,F)=>(x(),D("tr",{key:e.filename},[t("td",null,g((p(a)-1)*p(o)+F+1),1),t("td",null,g(e.yearMonth),1),t("td",null,g(e.fileType),1),t("td",null,g(e.fileCode),1),t("td",{onClick:gt=>V(e.fileType,e.fileName),style:{cursor:"pointer",color:"blue","text-decoration":"underline"}},g(e.fileName),9,it),t("td",null,g(e.result),1),t("td",null,g(e.createDt),1)]))),128))])]),t("div",rt,[ct,dt,n(z,{align:"center",justify:"center"},{default:u(()=>[n(S,{cols:"auto"},{default:u(()=>[t("button",{onClick:C,disabled:p(a)===1},mt,8,ut),T("   "),(x(!0),D(j,null,I(c.value,e=>(x(),D("button",{key:e,onClick:F=>b(e),class:W({active:e===p(a)})},g(e),11,ht))),128)),T("   "),t("button",{onClick:h,disabled:p(a)===c.value||c.value<1},ft,8,vt)]),_:1})]),_:1})])])])]))}};export{Ft as default};
