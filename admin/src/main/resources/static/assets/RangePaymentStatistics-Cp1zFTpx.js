import{U as z,W as G,e as j,c,d as b,w,a,o as i,F as U,g as B,b as J,H as o,R,D as A,Z as W,X as Y,h as S,Y as O,J as V,n as P,t as u}from"./index-Cl5wPPhe.js";import{a as F}from"./axios-B4uVmeYG.js";import{d as E}from"./dcb-DFDBfy1j.js";import{V as H,a as k}from"./VInput-BUIgaqBY.js";import{V as X}from"./VTable-k-LXP69-.js";import{V as Z}from"./VCheckbox-CPRIYXw-.js";import"./VGrid-CcRiOlXM.js";import"./transition-D5l4heR3.js";import"./VCheckboxBtn-CE1nV8AX.js";const q=z("main",{state:()=>({contents:[]}),actions:{async getDailyStatistics(x,y,r){const v="http://192.168.10.31:8080/payment/range/day";try{const m=x.join(","),h=await F.get(v,{params:{dcbs:m,startDate:y,endDate:r}});this.contents=h.data.mapResult}catch{alert("작업 중 에러가 발생했습니다.")}},async getMonthlyStatistics(x,y,r){const v="http://192.168.10.31:8080/payment/range/month";try{const m=x.join(","),h=await F.get(v,{params:{dcbs:m,startDate:y,endDate:r}});this.contents=h.data.mapResult,this.dcb=m}catch{alert("작업 중 에러가 발생했습니다.")}},async exportDailyData(x,y,r){const v="http://192.168.10.31:8080/payment/range/day/excel";try{const m=x.join(","),h=await F.get(v,{params:{dcbs:m,startDate:y,endDate:r},responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}),_=new Date,$=_.getFullYear(),f=String(_.getMonth()+1).padStart(2,"0"),p=String(_.getDate()).padStart(2,"0"),D=String(_.getHours()).padStart(2,"0"),s=String(_.getMinutes()).padStart(2,"0"),l=String(_.getSeconds()).padStart(2,"0"),C=`${$}${f}${p}${D}${s}${l}`,M=h.headers["content-disposition"],T=M?M.split("filename=")[1]:`${m} ${y}~${r} 기간별 일 결제 통계_${C}.xlsx`,L=new Blob([h.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=window.URL.createObjectURL(L),e=document.createElement("a");e.href=n,e.setAttribute("download",T),document.body.appendChild(e),e.click(),document.body.removeChild(e),window.URL.revokeObjectURL(n)}catch{alert("작업 중 에러가 발생했습니다.")}},async exportMonthlyData(x,y,r){const v="http://192.168.10.31:8080/payment/range/month/excel";try{const m=x.join(","),h=await F.get(v,{params:{dcbs:m,startDate:y,endDate:r},responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}),_=new Date,$=_.getFullYear(),f=String(_.getMonth()+1).padStart(2,"0"),p=String(_.getDate()).padStart(2,"0"),D=String(_.getHours()).padStart(2,"0"),s=String(_.getMinutes()).padStart(2,"0"),l=String(_.getSeconds()).padStart(2,"0"),C=`${$}${f}${p}${D}${s}${l}`,M=h.headers["content-disposition"],T=M?M.split("filename=")[1]:`${m} ${y}~${r} 기간별 월 결제 통계_${C}.xlsx`,L=new Blob([h.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=window.URL.createObjectURL(L),e=document.createElement("a");e.href=n,e.setAttribute("download",T),document.body.appendChild(e),e.click(),document.body.removeChild(e),window.URL.revokeObjectURL(n)}catch{alert("작업 중 에러가 발생했습니다.")}}}}),K={class:"content-wrapper"},Q=a("div",{class:"label-text"},[V(" ※ 일별 최대 조회 기간 : "),a("b",null,"31일"),V(),a("br"),V(" ※ 월별 최대 조회 기간 : "),a("b",null,"3달")],-1),tt=a("strong",null,"DCB :",-1),et=a("option",{value:"day"},"일별",-1),at=a("option",{value:"month"},"월별",-1),st=[et,at],nt=["max"],ot=["min","max"],lt=["max"],rt=["min","max"],dt=a("br",null,null,-1),it={class:"table-wrapper"},ut=a("thead",null,[a("tr",null,[a("th",null,"기간"),a("th",null,"결제 구간"),a("th",null,"결제자 수"),a("th",null,"전체 결제 건수"),a("th",null,"결제 금액"),a("th",null,"환불/취소 금액"),a("th",null,"실결제 금액"),a("th",null,"인당 결제 금액")])],-1),ct=["rowspan"],pt=["rowspan"],mt={key:1},ht=a("td",{colspan:"8",style:{"text-align":"center"}},"데이터가 없습니다.",-1),_t=[ht],yt=a("br",null,null,-1),ft=a("br",null,null,-1),gt={colspan:"8",style:{"text-align":"center","font-weight":"bold"}},vt=["rowspan"],bt=["rowspan"],$t={__name:"RangePaymentStatistics",setup(x){const y=q(),{contents:r}=G(y),v=()=>{const n=new Date,e=new Date(n);return e.setDate(n.getDate()-1),e.toISOString().split("T")[0]},m=(n,e=31)=>{const t=new Date(n);return t.setDate(t.getDate()-e),t.toISOString().split("T")[0]},h=()=>{const n=new Date,e=n.getFullYear(),t=String(n.getMonth()).padStart(2,"0");return`${e}-${t}`},_=n=>{const e=new Date(n),t=e.getMonth();e.setMonth(t-3);const g=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0");return`${g}-${d}`},$=()=>{s.value="",l.value="",p.value==="day"?(D.value=v(),s.value=m(new Date),l.value=v()):(D.value=h(),s.value=_(new Date),l.value=h())};let f=j([]),p=j("month"),D=j(h()),s=j(_(new Date)),l=j(h());const C=()=>{if(f.value.length===0){alert("조회할 DCB를 선택해주세요.");return}if(s.value===""||l.value===""){alert("조회할 날짜를 모두 선택해주세요.");return}if(p.value==="day"){const n=new Date(v()),e=new Date(s.value),t=new Date(l.value);if((t.getTime()-e.getTime())/(1e3*3600*24)>30){alert("일별 조회는 최대 31일까지만 가능합니다.");return}if(e>n||t>n){alert("선택한 날의 데이터가 아직 생성되지 않았습니다.");return}}else{const n=h(),e=new Date(s.value),t=new Date(l.value),g=e.getMonth()+1+e.getFullYear()*12;if(t.getMonth()+1+t.getFullYear()*12-g>2){alert("월별 조회는 최대 3개월까지만 가능합니다.");return}if(s.value>n||l.value>n){alert("선택한 달의 데이터가 아직 생성되지 않았습니다.");return}}r.value=[],M()},M=async()=>{p.value==="day"?await y.getDailyStatistics(f.value,s.value,l.value):await y.getMonthlyStatistics(f.value,s.value,l.value)},T=()=>{if(f.value.length===0){alert("조회할 DCB를 선택해주세요.");return}if(s.value===""||l.value===""){alert("조회할 날짜를 모두 선택해주세요.");return}if(p.value==="day"){const n=new Date(v());if(new Date(s.value)>n||new Date(l.value)>n){alert("선택한 날의 데이터가 아직 생성되지 않았습니다.");return}}else{const n=h();if(s.value>n||l.value>n){alert("선택한 달의 데이터가 아직 생성되지 않았습니다.");return}}L()},L=()=>{p.value==="day"?y.exportDailyData(f.value,s.value,l.value):y.exportMonthlyData(f.value,s.value,l.value)};return(n,e)=>(i(),c("div",K,[b(H,null,{default:w(()=>[b(k,{cols:"auto"},{default:w(()=>[Q]),_:1})]),_:1}),b(H,{align:"center",justify:"end"},{default:w(()=>[b(k,{cols:"auto"},{default:w(()=>[tt]),_:1}),(i(!0),c(U,null,B(o(E),t=>(i(),J(k,{cols:"auto"},{default:w(()=>[b(Z,{label:t,value:t,modelValue:o(f),"onUpdate:modelValue":e[0]||(e[0]=g=>R(f)?f.value=g:f=g)},null,8,["label","value","modelValue"])]),_:2},1024))),256)),b(k,{cols:"auto"},{default:w(()=>[A(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>R(p)?p.value=t:p=t),onChange:$},st,544),[[W,o(p)]])]),_:1}),b(k,{cols:"auto"},{default:w(()=>[o(p)==="day"?A((i(),c("input",{key:0,type:"date","onUpdate:modelValue":e[2]||(e[2]=t=>R(s)?s.value=t:s=t),max:o(D)},null,8,nt)),[[Y,o(s)]]):S("",!0),o(p)==="day"?A((i(),c("input",{key:1,type:"date","onUpdate:modelValue":e[3]||(e[3]=t=>R(l)?l.value=t:l=t),min:o(s),max:o(D)},null,8,ot)),[[Y,o(l)]]):S("",!0),o(p)==="month"?A((i(),c("input",{key:2,type:"month","onUpdate:modelValue":e[4]||(e[4]=t=>R(s)?s.value=t:s=t),max:o(D)},null,8,lt)),[[Y,o(s)]]):S("",!0),o(p)==="month"?A((i(),c("input",{key:3,type:"month","onUpdate:modelValue":e[5]||(e[5]=t=>R(l)?l.value=t:l=t),min:o(s),max:o(D)},null,8,rt)),[[Y,o(l)]]):S("",!0)]),_:1}),b(k,{cols:"auto"},{default:w(()=>[b(O,{variant:"elevated",onClick:C},{default:w(()=>[V(" 조회 ")]),_:1})]),_:1}),b(k,{cols:"auto"},{default:w(()=>[b(O,{variant:"elevated",onClick:T},{default:w(()=>[V(" 엑셀 ")]),_:1})]),_:1})]),_:1}),dt,a("div",it,[b(X,{class:"table-container"},{default:w(()=>[ut,a("tbody",null,[o(r).total&&o(r).total.length?(i(!0),c(U,{key:0},B(o(r).total,(t,g)=>(i(),c("tr",{key:g,class:P("section-"+(g%3+1))},[t.stat_month&&g%7===0?(i(),c("td",{key:0,rowspan:o(r).total.filter(d=>d.stat_month===t.stat_month).length,class:"start-table"},u(t.stat_month),9,ct)):S("",!0),t.stat_day&&g%7===0?(i(),c("td",{key:1,rowspan:o(r).total.filter(d=>d.stat_day===t.stat_day).length,class:"start-table"},u(t.stat_day),9,pt)):S("",!0),a("td",null,u(t.a_stat),1),a("td",null,u(t.b_stat),1),a("td",null,u(t.c_stat),1),a("td",null,u(t.d_stat),1),a("td",null,u(t.e_stat),1),a("td",null,u(t.f_stat),1),a("td",null,u(t.g_stat),1)],2))),128)):(i(),c("tr",mt,_t)),(i(!0),c(U,null,B(o(E),(t,g)=>(i(),c(U,{key:g},[o(r)[t]&&o(r)[t].length?(i(),c(U,{key:0},[yt,V(),ft,a("tr",null,[a("td",gt,u(t)+" 통계",1)]),(i(!0),c(U,null,B(o(r)[t],(d,I)=>(i(),c("tr",{key:I,class:P("section-"+(I%3+1))},[d.stat_month&&I%7===0?(i(),c("td",{key:0,rowspan:o(r).total.filter(N=>N.stat_month===d.stat_month).length,class:"start-table"},u(d.stat_month),9,vt)):S("",!0),d.stat_day&&I%7===0?(i(),c("td",{key:1,rowspan:o(r).total.filter(N=>N.stat_day===d.stat_day).length,class:"start-table"},u(d.stat_day),9,bt)):S("",!0),a("td",null,u(d.a_stat),1),a("td",null,u(d.b_stat),1),a("td",null,u(d.c_stat),1),a("td",null,u(d.d_stat),1),a("td",null,u(d.e_stat),1),a("td",null,u(d.f_stat),1),a("td",null,u(d.g_stat),1)],2))),128))],64)):S("",!0)],64))),128))])]),_:1})])]))}};export{$t as default};
