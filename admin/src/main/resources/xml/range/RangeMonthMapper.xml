<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.admin.range_month.mapper.RangeMonthMapper">
    <select id="getRangeMonthScheduleList" resultMap="com.example.admin.range_month.dto.RangeMonth">
        SELECT
            TO_CHAR(TO_DATE(STAT_DAY, 'YYYY-MM-DD'), 'YYYY-MM') AS STAT_MONTH,
            A_STAT,
            SUM(B_STAT) AS B_STAT,
            SUM(C_STAT) AS C_STAT,
            SUM(D_STAT) AS D_STAT,
            SUM(E_STAT) AS E_STAT,
            SUM(F_STAT) AS F_STAT,
            CASE
                WHEN SUM(B_STAT) > 0 THEN SUM(F_STAT) / SUM(B_STAT)
                ELSE 0
                END AS G_STAT,
            DCB
        FROM
            TB_STATS_RANGE_DAY
        WHERE TRANSACTION_DT BETWEEN TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM') || '-01', 'YYYY-MM-DD')
                  AND LAST_DAY(TO_DATE(TO_CHAR(SYSDATE, 'YYYY-MM') || '-01', 'YYYY-MM-DD'))
        GROUP BY
            TO_CHAR(TO_DATE(STAT_DAY, 'YYYY-MM-DD'), 'YYYY-MM'),
            A_STAT
    </select>

    <resultMap id="rangeMonthMap" type="com.example.admin.range_month.dto.RangeMonth">
        <result column="STAT_MONTH" property="stat_month"/>
        <result column="A_STAT" property="a_stat"/>
        <result column="B_STAT" property="b_stat"/>
        <result column="C_STAT" property="c_stat"/>
        <result column="D_STAT" property="d_stat"/>
        <result column="E_STAT" property="e_stat"/>
        <result column="F_STAT" property="f_stat"/>
        <result column="G_STAT" property="g_stat"/>
    </resultMap>
</mapper>